@model List<RealEstateListingPlatform.Models.LeadViewModel>

@{
    ViewData["Title"] = "My Interested Listings";
    Layout = "_Layout";
}

<div class="container py-5 mt-5">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="display-5 fw-bold mb-2">
                My Interested Listings
            </h1>
            <p class="text-muted">Track all properties you've expressed interest in</p>
        </div>
    </div>

    @if (Model == null || !Model.Any())
    {
        <div class="row">
            <div class="col-12">
                <div class="card border-0 shadow-sm rounded-4 text-center py-5">
                    <div class="card-body">
                        <i class="bi bi-inbox display-1 text-muted mb-4"></i>
                        <h3 class="fw-bold mb-3">No Interested Listings Yet</h3>
                        <p class="text-muted mb-4">You haven't expressed interest in any properties yet. Start exploring!</p>
                        <a asp-controller="Listings" asp-action="AllListings" class="btn btn-primary btn-lg rounded-pill px-5">
                            <i class="bi bi-search me-2"></i>Browse Listings
                        </a>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <!-- Statistics Cards -->
        <div class="row g-4 mb-4">
            <div class="col-md-3">
                <div class="stat-card stat-total">
                    <i class="bi bi-heart-fill stat-icon"></i>
                    <div class="stat-value">@Model.Count</div>
                    <div class="stat-label">Total Interested</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card stat-new">
                    <i class="bi bi-star-fill stat-icon"></i>
                    <div class="stat-value">@Model.Count(l => l.Status == "New")</div>
                    <div class="stat-label">Pending</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card stat-contacted">
                    <i class="bi bi-chat-dots-fill stat-icon"></i>
                    <div class="stat-value">@Model.Count(l => l.Status == "Contacted")</div>
                    <div class="stat-label">Contacted</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card stat-closed">
                    <i class="bi bi-check-circle-fill stat-icon"></i>
                    <div class="stat-value">@Model.Count(l => l.Status == "Closed")</div>
                    <div class="stat-label">Closed</div>
                </div>
            </div>
        </div>

        <!-- Listings Grid -->
        <div class="row g-4">
            @foreach (var lead in Model)
            {
                <div class="col-md-6 col-lg-4">
                    <div class="card listing-card border-0 shadow-sm rounded-4 h-100 overflow-hidden">
                        <div class="position-relative">
                            <img src="@(string.IsNullOrEmpty(lead.ListingImageUrl) ? "https://tjh.com/wp-content/uploads/2023/06/TJH_HERO_TJH-HOME@2x-1.webp" : lead.ListingImageUrl)" 
                                 class="card-img-top" 
                                 alt="@lead.ListingTitle"
                                 style="height: 200px; object-fit: cover;">
                            <span class="position-absolute top-0 end-0 m-3 @lead.StatusBadgeClass rounded-pill px-3 py-2">
                                @lead.Status
                            </span>
                            @if (!string.IsNullOrEmpty(lead.TransactionType))
                            {
                                <span class="position-absolute top-0 start-0 m-3 badge @(lead.TransactionType == "Sell" ? "bg-primary" : "bg-success") rounded-pill px-3 py-2">
                                    @(lead.TransactionType == "Sell" ? "For Sale" : "For Rent")
                                </span>
                            }
                        </div>
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title fw-bold mb-2">@lead.ListingTitle</h5>
                            <p class="text-muted small mb-2">
                                <i class="bi bi-geo-alt-fill text-primary"></i> @lead.ListingAddress
                            </p>
                            <h4 class="text-primary fw-bold mb-3">@lead.ListingPrice.ToString("N0") VND</h4>
                            
                            @if (!string.IsNullOrEmpty(lead.PropertyType) || !string.IsNullOrEmpty(lead.Area) || lead.Bedrooms.HasValue || lead.Bathrooms.HasValue)
                            {
                                <div class="d-flex gap-3 mb-3 text-muted small">
                                    @if (!string.IsNullOrEmpty(lead.PropertyType))
                                    {
                                        <span><i class="bi bi-house"></i> @lead.PropertyType</span>
                                    }
                                    @if (!string.IsNullOrEmpty(lead.Area))
                                    {
                                        <span><i class="bi bi-aspect-ratio"></i> @lead.Area mï¿½</span>
                                    }
                                    @if (lead.Bedrooms.HasValue)
                                    {
                                        <span><i class="bi bi-door-open"></i> @lead.Bedrooms BR</span>
                                    }
                                    @if (lead.Bathrooms.HasValue)
                                    {
                                        <span><i class="bi bi-droplet"></i> @lead.Bathrooms BA</span>
                                    }
                                </div>
                            }
                            
                            <div class="bg-light rounded-3 p-3 mb-3">
                                <div class="small text-muted mb-1">
                                    <strong>Your Message:</strong>
                                </div>
                                <p class="small mb-0 text-truncate">
                                    @(string.IsNullOrEmpty(lead.Message) ? "<em>No message</em>" : lead.Message)
                                </p>
                            </div>

                            @if (!string.IsNullOrEmpty(lead.ListerNote))
                            {
                                <div class="alert alert-info border-0 rounded-3 mb-3 py-2 px-3">
                                    <div class="small mb-1">
                                        <strong><i class="bi bi-chat-quote"></i> Lister's Response:</strong>
                                    </div>
                                    <p class="small mb-0">@lead.ListerNote</p>
                                </div>
                            }

                            <div class="small text-muted mb-3">
                                <i class="bi bi-person"></i> Listed by: <strong>@lead.ListerName</strong><br/>
                                <i class="bi bi-clock"></i> Interested @lead.TimeAgo
                            </div>

                            <div class="mt-auto d-grid gap-2">
                                <a asp-controller="Listings" asp-action="PropertyDetail" asp-route-id="@lead.ListingId" 
                                   class="btn btn-primary rounded-pill">
                                    <i class="bi bi-eye me-2"></i>View Property
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>

@section Styles {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        /* Statistics Cards */
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
        }

        .stat-card .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            opacity: 0.8;
        }

        .stat-total .stat-icon { color: #dc3545; }
        .stat-new .stat-icon { color: #28a745; }
        .stat-contacted .stat-icon { color: #0d6efd; }
        .stat-closed .stat-icon { color: #6c757d; }

        .stat-card .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2c3e50;
        }

        .stat-card .stat-label {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-top: 0.25rem;
        }

        /* Listing Cards */
        .listing-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .listing-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15) !important;
        }

        .card-img-top {
            transition: transform 0.3s ease;
        }

        .listing-card:hover .card-img-top {
            transform: scale(1.05);
        }

        .badge {
            font-weight: 600;
            font-size: 0.75rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        /* Responsive */
        @@media (max-width: 768px) {
            .stat-card .stat-value {
                font-size: 2rem;
            }

            .stat-card .stat-icon {
                font-size: 2rem;
            }
        }
    </style>
}
