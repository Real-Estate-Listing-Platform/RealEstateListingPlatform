@model IEnumerable<RealEstateListingPlatform.Models.ListingApprovalViewModel>

@{
    ViewData["Title"] = "Listings";
    Layout = "_Layout";
    var formAction = ViewData["FilterFormAction"]?.ToString() ?? Url.Action("AllListings");
    var formType = ViewData["FilterFormType"]?.ToString();
    var filterLocation = ViewData["FilterLocation"]?.ToString() ?? "";
    var filterPropertyTypes = (ViewData["FilterPropertyTypes"] as IEnumerable<string>)?.ToList() ?? new List<string>();
    var filterMaxPriceRaw = ViewData["FilterMaxPriceRaw"]?.ToString() ?? "";
}

<div class="container pt-5 mt-5 mb-5">
    <div class="row">
        <aside class="col-lg-3">
            <div class="card border-0 shadow-sm rounded-4 p-3 mb-4 sticky-top" style="top: 100px;">
                <h5 class="fw-bold mb-3">Search filters</h5>
                <form method="get" action="@formAction" id="searchFiltersForm">
                    @if (!string.IsNullOrEmpty(formType))
                    {
                        <input type="hidden" name="type" value="@formType" />
                    }
                    <div class="mb-3">
                        <label class="form-label small fw-bold">Area</label>
                        <input type="text" name="location" class="form-control form-control-sm border-light bg-light" placeholder="Quận, phường, đường, thành phố..." value="@filterLocation" />
                    </div>

                    <div class="mb-3">
                        <label class="form-label small fw-bold">Price</label>
                        <input type="text" name="maxPrice" id="maxPriceInput" class="form-control form-control-sm border-light bg-light" placeholder="VD: 5 tỷ, 5B, 5000000000" value="@filterMaxPriceRaw" />
                        <p class="small text-muted mt-1 mb-0">Mức giá gợi ý:</p>
                        <div class="d-flex flex-wrap gap-1 mt-1">
                            <button type="button" class="btn btn-outline-secondary btn-sm rounded-pill price-suggestion" data-value="">Bất kỳ</button>
                            <button type="button" class="btn btn-outline-secondary btn-sm rounded-pill price-suggestion" data-value="1 tỷ">Dưới 1 tỷ</button>
                            <button type="button" class="btn btn-outline-secondary btn-sm rounded-pill price-suggestion" data-value="5 tỷ">1–5 tỷ</button>
                            <button type="button" class="btn btn-outline-secondary btn-sm rounded-pill price-suggestion" data-value="10 tỷ">5–10 tỷ</button>
                            <button type="button" class="btn btn-outline-secondary btn-sm rounded-pill price-suggestion" data-value="50 tỷ">10–50 tỷ</button>
                            <button type="button" class="btn btn-outline-secondary btn-sm rounded-pill price-suggestion" data-value="100 tỷ">50 tỷ+</button>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label small fw-bold">Property Type</label>
                        <div class="d-flex flex-column gap-1">
                            @if (filterPropertyTypes.Contains("Apartment", StringComparer.OrdinalIgnoreCase)) { <label class="form-check small"><input class="form-check-input" type="checkbox" name="propertyType" value="Apartment" checked /> Apartment</label> } else { <label class="form-check small"><input class="form-check-input" type="checkbox" name="propertyType" value="Apartment" /> Apartment</label> }
                            @if (filterPropertyTypes.Contains("Land", StringComparer.OrdinalIgnoreCase)) { <label class="form-check small"><input class="form-check-input" type="checkbox" name="propertyType" value="Land" checked /> Land</label> } else { <label class="form-check small"><input class="form-check-input" type="checkbox" name="propertyType" value="Land" /> Land</label> }
                            @if (filterPropertyTypes.Contains("Villa", StringComparer.OrdinalIgnoreCase)) { <label class="form-check small"><input class="form-check-input" type="checkbox" name="propertyType" value="Villa" checked /> Villa</label> } else { <label class="form-check small"><input class="form-check-input" type="checkbox" name="propertyType" value="Villa" /> Villa</label> }
                            @if (filterPropertyTypes.Contains("Office", StringComparer.OrdinalIgnoreCase)) { <label class="form-check small"><input class="form-check-input" type="checkbox" name="propertyType" value="Office" checked /> Office</label> } else { <label class="form-check small"><input class="form-check-input" type="checkbox" name="propertyType" value="Office" /> Office</label> }
                            @if (filterPropertyTypes.Contains("Townhouse", StringComparer.OrdinalIgnoreCase)) { <label class="form-check small"><input class="form-check-input" type="checkbox" name="propertyType" value="Townhouse" checked /> Townhouse</label> } else { <label class="form-check small"><input class="form-check-input" type="checkbox" name="propertyType" value="Townhouse" /> Townhouse</label> }
                            @if (filterPropertyTypes.Contains("Room", StringComparer.OrdinalIgnoreCase)) { <label class="form-check small"><input class="form-check-input" type="checkbox" name="propertyType" value="Room" checked /> Room</label> } else { <label class="form-check small"><input class="form-check-input" type="checkbox" name="propertyType" value="Room" /> Room</label> }
                            @if (filterPropertyTypes.Contains("Penthouse", StringComparer.OrdinalIgnoreCase)) { <label class="form-check small"><input class="form-check-input" type="checkbox" name="propertyType" value="Penthouse" checked /> Penthouse</label> } else { <label class="form-check small"><input class="form-check-input" type="checkbox" name="propertyType" value="Penthouse" /> Penthouse</label> }
                        </div>
                    </div>

                    <button type="submit" class="btn btn-auth-primary w-100 rounded-pill btn-sm mt-2">Apply</button>
                </form>
            </div>
        </aside>

        <main class="col-lg-9">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="fw-bold mb-0">@ViewData["Title"]</h3>
                <span class="text-muted small">Find <b>@Model.Count()</b> result</span>
            </div>

            <div class="row g-4">
                @foreach (var item in Model)
                {
                    <div class="col-md-6 col-xl-4">
                        <div class="card property-card h-100 border-0 shadow-sm overflow-hidden rounded-4">
                            <div class="position-relative">
                                <img src="@item.ImageUrl" class="card-img-top" style="height: 200px; object-fit: cover;">
                                <div class="position-absolute top-0 end-0 m-2">
                                    <button class="btn btn-light btn-sm rounded-circle shadow-sm"><i class="bi bi-heart"></i></button>
                                </div>
                                <span class="badge @(item.TransactionType == "Sell" ? "bg-primary" : "bg-success") position-absolute bottom-0 start-0 m-3 rounded-pill px-3">
                                    @(item.TransactionType == "Sell" ? "Sale" : "Rent")
                                </span>
                            </div>
                            <div class="card-body">
                                <h6 class="card-title fw-bold text-truncate">@item.Title</h6>
                                <p class="text-muted small"><i class="bi bi-geo-alt"></i> @item.Address</p>
                                <div class="d-flex justify-content-between align-items-center mt-3">
                                    <span class="h5 text-primary fw-bold mb-0">@item.FormattedPrice</span>
                                    <div class="property-icons text-muted small">
                                        <span><i class="bi bi-door-open"></i> @item.Bedrooms</span>
                                        <span class="ms-2"><i class="bi bi-droplet"></i> @item.Bathrooms</span>
                                        <span class="ms-2 d-inline-flex align-items-center" title="Floors"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 24 24"><path d="M2 19h4v-4h4v-4h4v-4h4V3H2v4h4v4H2v4h4v4H2z"/></svg> <span class="ms-1">@item.Floors</span></span>
                                        <span class="ms-2"><i class="bi bi-aspect-ratio"></i> @(item.Area)m²</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer bg-transparent border-top-0 pb-3">
                                <a asp-controller="Listings" asp-action="PropertyDetail" asp-route-id="@item.Id" class="btn btn-outline-primary w-100 rounded-pill">Details</a>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </main>
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>

        
        aside .card {
            transition: box-shadow 0.3s ease;
        }

        
        .property-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

            .property-card:hover {
                transform: translateY(-8px);
                box-shadow: 0 1rem 3rem rgba(0,0,0,0.1) !important;
            }

        
        .bg-success {
            background-color: #28a745 !important;
        }

        .bg-primary {
            background-color: #0d6efd !important;
        }

        
        @@media (max-width: 991.98px) {
            aside .card {
                position: relative !important;
                top: 0 !important;
                margin-bottom: 2rem;
            }
        }
    </style>
}

@section Scripts {
    <script>
        (function () {
            var input = document.getElementById('maxPriceInput');
            document.querySelectorAll('.price-suggestion').forEach(function (btn) {
                btn.addEventListener('click', function () {
                    if (input) input.value = this.getAttribute('data-value') || '';
                });
            });
        })();
    </script>
}
